<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SCARA Robot Term Project: SCARA Robot Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SCARA Robot Term Project
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('Design.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">SCARA Robot Design </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_intro"></a>
Preprocessing of X/Y Datapoints</h1>
<p >To make our lives easier we plan on using an xy plotting app to turn our drawings into usable coordinates. With these files copied to the Nucleo, we are able to import and read the x and y position coordinates using the open and readlines methods for our text files. Before we import the desired x,y position text file, we have to define which text file we would like to run on our engraver. This is done using a custom GUI that allows the user to select which text file they would like to run. Once the user has defined which text file they would like to run, the data points from the text file are imported and stored in a list. Once the data points are imported, we use our conversion factors to calculate the arm angles needed for our desired coordinates.</p>
<h2><a class="anchor" id="DH"></a>
Explained    Denavit Hartenberg Representation of Robots</h2>
<p >In order to calculate the angles for both rotational axes, we decided that using the Denavit-Hartenberg solution method would best suit our system the best. The Denavit-Hartenberg matrix representation enables the calculation of forward and inverse kinematics of translated coordinate frames using matrices. These matrices are defined by translating and rotating intermediate axes along the z and x axes to move from the base of our robot to the end effector (laser head). The derivation for our matrix values are included below for reference. Using the theta, d, a, and alpha terms for each translation we created a set of matrix multiplications which allowed us to calculate the angles needed to position the laser head at each given x,y coordinate location.</p>
<div class="image">
<img src="DH_Derivation.png" alt="" width="800px"/>
<div class="caption">
Denavit-Hartenberg Matrix Derivations</div></div>
<h2><a class="anchor" id="Control_Loop"></a>
Control Scheme Description</h2>
<p >In order to control the robot, we needed to come up with a set of tasks that would be be performed over and over to move and control our two axes. The tasks we decided to use inluded a position check task, and a motor control task for each motor. The position check task was used to pull encoder position readings and check those values against the setpoint positions. If our error is within a given interval new setpoint values are pulled for each motor and the PID control scheme runs using new setpoints. The position check task is the most important, as we want to know when we hit each setpoint as accurately as possible. This task is then followed by the two moto control tasks, sending a new PWM to each motor every time they are run. Once the position check task runs out of encoder values the engraver is turned off and the motors are sent to their home positions.</p>
<h2><a class="anchor" id="File_Descript"></a>
File Descriptions</h2>
<p >In order to organize our project files, we wrote as many external files as possible with their own functions which we then called in our main script. The first method we call inside main is the user input function. This function is defined in the <a class="el" href="user__task_8py.html" title="sets up user task">user_task.py</a> file and allows the user to decide which text file will be imported for engraving. Once the text file has been read into main, we perform the necessary kinematic conversions to turn x and y positions into encoder tick values. To do this we call the inv_kinematics function in <a class="el" href="kinematics_8py.html" title="Finds initial angles necessary for xy coordinates.">kinematics.py</a>. This is followed up with the homing method written to home the two arms and zero the encoders at the given reset positions. This function is defined in the <a class="el" href="homing__script_8py.html" title="Homes robot.">homing_script.py</a> file and is called inside <a class="el" href="main_8py.html" title="Reads ADC pin on Nucleo and saves data in queue.">main.py</a>. Once our arms are homed and encoders zeroed, we instantiate our position check and control loop tasks as tasks and begin our task scheduler with their respective periods and priorities. This control scheme runs until all x and y positions are hit and the robot is returned to its home location with the laser turned off.</p>
<h2><a class="anchor" id="Tasks"></a>
Task Diagram</h2>
<p >Our task diagram for our SCARA robot is found below. We had a massive overhaul of our software structure since we started. Notably, we have three tasks with only two shares being used by the two motor tasks. Our third task, the positon checker, simply reads the current encoder value and determines if the motor has not moved. If this is the case, the setpoint has been reached and the next coordinate values are sent to each motor.</p>
<div class="image">
<img src="SCARA_Task_Diagram-1.png" alt="" width="800px"/>
<div class="caption">
SCARA Robot Task Diagram</div></div>
<h2><a class="anchor" id="FSM"></a>
Finite State Machine Diagrams</h2>
<p >Our FSM diagrams have also simplified since we first embarked on our term project. While the user task is not a task within our scheduler, it is necessary for preprocessing as the user must select an image which then returns the x and y coordinates for that image. These coordinates are then fed into a queue which the position checker task utilizes. From here, the current setpoint is compared to the desired setpoint, at which the next values will be taken by the motor tasks. The motor tasks do not return anything nor change other tasks' states. The motor tasks simply retrieve the setpoint values which the controller then manipulates to deliver a necessary PWM.</p>
<div class="image">
<img src="User_Task_FSM-1.png" alt="" width="800px"/>
<div class="caption">
User Task FSM</div></div>
<div class="image">
<img src="Position_Check_Task_FSM-1.png" alt="" width="800px"/>
<div class="caption">
Position Check Task FSM</div></div>
<div class="image">
<img src="Motor_Task_FSM-1.png" alt="" width="800px"/>
<div class="caption">
Motor Task FSM</div></div>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Mar 15 2022 21:19:34 for SCARA Robot Term Project by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
